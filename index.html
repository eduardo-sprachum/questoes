<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Banco de Quest√µes</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <h1>Banco de Quest√µes</h1>

    <form id="questaoForm">
      <!-- Universidade -->
      <label for="universidade">Universidade:</label>
      <select id="universidade" required>
        <option value="">Selecione</option>
        <option value="UEPG">UEPG</option>
        <option value="UEM">UEM</option>
        <option value="UEL">UEL</option>
        <option value="UNIOESTE">UNIOESTE</option>
        <option value="UNICENTRO">UNICENTRO</option>
        <option value="UFPR">UFPR</option>
        <option value="IFPR">IFPR</option>
        <option value="ENEM">ENEM</option>
        <option value="UNESPAR">UNESPAR</option>
        <option value="UENP">UENP</option>
      </select>

      <!-- Ano -->
      <label for="ano">Ano:</label>
      <input type="number" id="ano" placeholder="Ex: 2024" min="1900" max="2100" required>

      <!-- Disciplina -->
      <label for="disciplina">Disciplina:</label>
      <select id="disciplina" required>
        <option value="">Selecione</option>
        <option value="Arte">Arte</option>
        <option value="Biologia">Biologia</option>
        <option value="Educa√ß√£o F√≠sica">Educa√ß√£o F√≠sica</option>
        <option value="F√≠sica">F√≠sica</option>
        <option value="Filosofia">Filosofia</option>
        <option value="Geografia">Geografia</option>
        <option value="Hist√≥ria">Hist√≥ria</option>
        <option value="Portugu√™s">Portugu√™s</option>
        <option value="Ingl√™s">Ingl√™s</option>
        <option value="Espanhol">Espanhol</option>
        <option value="Franc√™s">Franc√™s</option>
        <option value="Qu√≠mica">Qu√≠mica</option>
        <option value="Sociologia">Sociologia</option>
        <option value="Matem√°tica">Matem√°tica</option>
        <option value="Literatura">Literatura</option>
      </select>

      <!-- Eixo tem√°tico (ser√° cascata preenchido depois) -->
      <label for="eixo">Eixo Tem√°tico:</label>
      <select id="eixo" required>
        <option value="">Selecione</option>
      </select>

      <!-- Assunto (ser√° cascata preenchido depois) -->
      <label for="assunto">Assunto:</label>
      <select id="assunto" required>
        <option value="">Selecione</option>
      </select>

      <!-- Enunciado -->
      <label for="enunciado">Enunciado:</label>
      <textarea id="enunciado" required></textarea>

      <!-- Alternativas -->
      <div id="alternativas-container"></div>

      <!-- Bot√£o -->
      <button type="submit">Salvar Quest√£o</button>
    </form>
  </div>

  <!-- JS -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, query, where } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    // üîπ CONFIGURA√á√ÉO DO FIREBASE
    const firebaseConfig = {
        apiKey: "AIzaSyD0qF3AkrrQO3XfjUC6xQl6bncrlFgURa8",
        authDomain: "questoes-7614e.firebaseapp.com",
        projectId: "questoes-7614e",
        storageBucket: "questoes-7614e.firebasestorage.app",
        messagingSenderId: "751632344545",
        appId: "1:751632344545:web:4613ee92692f5d527cdea0",
        measurementId: "G-DS8N95SV31"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const codigosDisciplina = {
      "Arte": "ART",
      "Biologia": "BIO",
      "Educa√ß√£o F√≠sica": "EDF",
      "F√≠sica": "FIS",
      "Filosofia": "FIL",
      "Geografia": "GEO",
      "Hist√≥ria": "HIS",
      "Portugu√™s": "POR",
      "Ingl√™s": "ING",
      "Espanhol": "ESP",
      "Franc√™s": "FRA",
      "Qu√≠mica": "QUI",
      "Sociologia": "SOC",
      "Matem√°tica": "MAT",
      "Literatura": "LIT"
    };

    const universidadeSelect = document.getElementById("universidade");
    const alternativasContainer = document.getElementById("alternativasContainer");
    const disciplinaSelect = document.getElementById("disciplina");
    const eixoSelect = document.getElementById("eixo");
    const assuntoSelect = document.getElementById("assunto");
    const form = document.getElementById("questaoForm");

    // Alternativas padr√£o
    const alternativasPadrao = `
      <label>Alternativa A:</label><input type="text" id="altA" required>
      <label>Alternativa B:</label><input type="text" id="altB" required>
      <label>Alternativa C:</label><input type="text" id="altC" required>
      <label>Alternativa D:</label><input type="text" id="altD" required>
      <label>Alternativa E:</label><input type="text" id="altE" required>
    `;

    // Alternativas somat√≥rio
    const alternativasSomatorio = (uni) => `
      <label>01:</label><input type="text" id="alt01" required>
      <label>02:</label><input type="text" id="alt02" required>
      <label>04:</label><input type="text" id="alt04" required>
      <label>08:</label><input type="text" id="alt08" required>
      <label>16:</label><input type="text" id="alt16" ${uni === "UEPG" ? "" : "required"}>
    `;

    // Troca din√¢mica de alternativas
    universidadeSelect.addEventListener("change", () => {
      const uni = universidadeSelect.value;
      if (uni === "UEM" || uni === "UEPG") {
        alternativasContainer.innerHTML = alternativasSomatorio(uni);
      } else {
        alternativasContainer.innerHTML = alternativasPadrao;
      }
    });

    // Cascata Disciplina ‚Üí Eixo
    const opcoesEixo = {
      "Matem√°tica": ["Matem√°tica B√°sica", "Conjuntos", "Fun√ß√µes", "M√≥dulo", "Exponencial", "Logaritmo", "Geometria Plana", "Trigonometria", "Geometria Espacial", "Geometria Anal√≠tica", "Matrizes", "Determinantes", "Sistemas Lineares", "Sequ√™ncias e Progress√µes", "An√°lise Combinat√≥ria", "Probabilidade", "Estat√≠stica", "N√∫meros Complexos", "Polin√¥mios", "Mista"],
      "Biologia": ["Introdu√ß√£o √† Biologia", "Bioqu√≠mica", "Citologia", "Bioenerg√©tica", "Histologia", "Reprodu√ß√£o", "Embriologia", "Taxonomia", "Microbiologia", "Micologia", "Bot√¢nica", "Zoologia", "Fisiologia Humana", "Gen√©tica", "Biotecnologia", "Evolu√ß√£o", "Ecologia", "Mista"],
      "F√≠sica": ["Introdu√ß√£o √† F√≠sica", "Cinem√°tica", "Din√¢mica", "Est√°tica", "Gravita√ß√£o Universal", "Trabalho e Energia", "Quantidade de Movimento", "Movimento Circular", "Fluidos", "MHS", "Termologia", "Ondulat√≥ria", "√ìptica", "Eletrost√°tica", "Eletrodin√¢mica", "Magnetismo", "F√≠sica Moderna", "An√°lise Dimensional", "Mista"],
      "Filosofia": ["Introdu√ß√£o √† Filosofia", "Filosofia Antiga", "Filosofia Medieval", "Filosofia Moderna", "Filosofia Contempor√¢nea", "Quest√µes Filos√≥ficas da Contemporaneidade", "Mista"],
      "Qu√≠mica": ["Introdu√ß√£o √† Qu√≠mica", "Estudo da Mat√©ria", "Atom√≠stica", "Mol√©culas", "Fun√ß√µes Inorg√¢nicas", "Rea√ß√µes Qu√≠micas", "Estequiometria", "Solu√ß√µes", "Termoqu√≠mica", "Cin√©tica Qu√≠mica", "Eletroqu√≠mica", "Hidrocarbonetos", "Fun√ß√µes Oxigenadas", "Fun√ß√µes Nitrogenadas", "Outras Fun√ß√µes Org√¢nicas", "Propriedades dos Compostos Org√¢nicos", "Rea√ß√µes Org√¢nicas", "Qu√≠mica Ambiental", "Mista"],
   }

    disciplinaSelect.addEventListener("change", () => {
      const disciplina = disciplinaSelect.value;
      eixoSelect.innerHTML = "<option value=''>Selecione</option>";
      assuntoSelect.innerHTML = "<option value=''>Selecione um eixo primeiro</option>";

      if (opcoesEixo[disciplina]) {
        opcoesEixo[disciplina].forEach(e => {
          const opt = document.createElement("option");
          opt.value = e;
          opt.textContent = e;
          eixoSelect.appendChild(opt);
        });
      }
    });

    // Cascata Eixo ‚Üí Assunto
    const opcoesAssunto = {
      "√Ålgebra": ["Equa√ß√µes", "Sistemas", "Polin√¥mios"],
      "Ecologia": ["Cadeias alimentares", "Ciclos biogeoqu√≠micos"]
      // ‚ûù preencha com seus dados
    };

    eixoSelect.addEventListener("change", () => {
      const eixo = eixoSelect.value;
      assuntoSelect.innerHTML = "<option value=''>Selecione</option>";

      if (opcoesAssunto[eixo]) {
        opcoesAssunto[eixo].forEach(a => {
          const opt = document.createElement("option");
          opt.value = a;
          opt.textContent = a;
          assuntoSelect.appendChild(opt);
        });
      }
    });

    // Listener submit
    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const universidade = universidadeSelect.value;
      const ano = document.getElementById("ano").value;
      const disciplina = disciplinaSelect.value;
      const eixo = eixoSelect.value;
      const assunto = assuntoSelect.value;
      const enunciado = document.getElementById("enunciado").value;

      // Valida√ß√£o do ano
      if (!/^\d{4}$/.test(ano)) {
        alert("Digite um ano v√°lido com 4 d√≠gitos!");
        return;
      }

      // Coleta alternativas
      let alternativas = {};
      if (universidade === "UEPG" || universidade === "UEM") {
        alternativas = {
          "01": document.getElementById("alt01")?.value || "",
          "02": document.getElementById("alt02")?.value || "",
          "04": document.getElementById("alt04")?.value || "",
          "08": document.getElementById("alt08")?.value || "",
          "16": document.getElementById("alt16")?.value || ""
        };
      } else {
        alternativas = {
          "A": document.getElementById("altA")?.value || "",
          "B": document.getElementById("altB")?.value || "",
          "C": document.getElementById("altC")?.value || "",
          "D": document.getElementById("altD")?.value || "",
          "E": document.getElementById("altE")?.value || ""
        };
      }

      try {
        const q = query(collection(db, "questoes"), where("disciplina", "==", disciplina));
        const snapshot = await getDocs(q);
        const numero = snapshot.size + 1;

        const disciplinaCodigo = codigosDisciplina[disciplina];
        const numeroFormatado = String(numero).padStart(5, "0");
        const codigoQuestao = disciplinaCodigo + numeroFormatado;

        await addDoc(collection(db, "questoes"), {
          codigo: codigoQuestao,
          universidade,
          ano,
          disciplina,
          eixo,
          assunto,
          enunciado,
          alternativas,
          criadoEm: new Date()
        });

        alert(`Quest√£o cadastrada com sucesso! C√≥digo: ${codigoQuestao}`);
        form.reset();
        alternativasContainer.innerHTML = "";
      } catch (error) {
        console.error("Erro ao salvar quest√£o:", error);
        alert("Erro ao salvar quest√£o!");
      }
    });
  </script>
</body>
</html>
